#
# Archivo de configuracion del servicio de integraci√≥n continua.
#
machine:
  timezone: 
    America/Bogota
  python:
    version: 2.7.11

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install apache2 git python python-pip libapache2-mod-wsgi libapache2-mod-python curl
    - sudo pip install --upgrade pip setuptools
    - sudo apt-get install libtiff5-dev libjpeg8-dev zlib1g-dev libfreetype6-dev liblcms2-dev libwebp-dev tcl8.6-dev tk8.6-dev python-tk
    - sudo apt-get install libxml2-dev libxslt1-dev python-dev
    - sudo pip install -U django requests openpyxl lxml python-pptx pyyaml decorators retrying urllib3 fluidasserts social-auth-app-django pylint pylint-django prospector
      #- sudo ln -s /home/ubuntu/fluid-integrates/ /var/www/
    - sudo cp -a /home/ubuntu/fluid-integrates/ /var/www/
    - sudo python /var/www/fluid-integrates/manage.py makemigrations
    - sudo python /var/www/fluid-integrates/manage.py migrate 
    - sudo chown -R www-data:www-data /var/www/fluid-integrates
    - sudo cp config/000-default.conf /etc/apache2/sites-available/000-default.conf
    - sudo a2ensite 000-default.conf
  post:
    - sudo service apache2 restart
test:
  override:
    - sudo python /var/www/fluid-integrates/manage.py test
    - prospector --pylint-config-file config/pylintrc -u django app
    - prospector --pylint-config-file config/pylintrc -u django fluidintegrates
